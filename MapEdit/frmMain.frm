VERSION 5.00
Object = "{F9043C88-F6F2-101A-A3C9-08002B2F49FB}#1.2#0"; "comdlg32.ocx"
Begin VB.Form frmMain 
   Caption         =   "MapEdit v 1.0 by Calvin Mayer"
   ClientHeight    =   8235
   ClientLeft      =   165
   ClientTop       =   855
   ClientWidth     =   9600
   LinkTopic       =   "Form1"
   ScaleHeight     =   8235
   ScaleWidth      =   9600
   StartUpPosition =   3  'Windows Default
   WindowState     =   2  'Maximized
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   15
      Left            =   120
      Picture         =   "frmMain.frx":0000
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   15
      Top             =   840
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   14
      Left            =   120
      Picture         =   "frmMain.frx":1212
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   14
      Top             =   1800
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   13
      Left            =   120
      Picture         =   "frmMain.frx":2424
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   13
      Top             =   7560
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   12
      Left            =   120
      Picture         =   "frmMain.frx":3636
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   12
      Top             =   7080
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   11
      Left            =   120
      Picture         =   "frmMain.frx":4848
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   11
      Top             =   6600
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   10
      Left            =   120
      Picture         =   "frmMain.frx":5A5A
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   10
      Top             =   6120
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   9
      Left            =   120
      Picture         =   "frmMain.frx":6C6C
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   9
      Top             =   5640
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   8
      Left            =   120
      Picture         =   "frmMain.frx":7E7E
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   8
      Top             =   5160
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   7
      Left            =   120
      Picture         =   "frmMain.frx":9090
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   7
      Top             =   4680
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   6
      Left            =   120
      Picture         =   "frmMain.frx":A2A2
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   6
      Top             =   4200
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   5
      Left            =   120
      Picture         =   "frmMain.frx":B4B4
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   5
      Top             =   3720
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   4
      Left            =   120
      Picture         =   "frmMain.frx":C6C6
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   4
      Top             =   3240
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   3
      Left            =   120
      Picture         =   "frmMain.frx":D8D8
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   3
      Top             =   2760
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   2
      Left            =   120
      Picture         =   "frmMain.frx":EAEA
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   2
      Top             =   2280
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   1
      Left            =   120
      Picture         =   "frmMain.frx":FCFC
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   1
      Top             =   1320
      Width           =   750
   End
   Begin VB.PictureBox picTile 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   450
      Index           =   0
      Left            =   120
      Picture         =   "frmMain.frx":10F0E
      ScaleHeight     =   450
      ScaleWidth      =   750
      TabIndex        =   0
      Top             =   360
      Width           =   750
   End
   Begin MSComDlg.CommonDialog theDialog 
      Left            =   2640
      Top             =   1200
      _ExtentX        =   847
      _ExtentY        =   847
      _Version        =   393216
   End
   Begin VB.Timer Timer1 
      Interval        =   1
      Left            =   1440
      Top             =   720
   End
   Begin VB.Menu mnuFile 
      Caption         =   "&File"
      Begin VB.Menu mnuNew 
         Caption         =   "&New"
      End
      Begin VB.Menu mnuLoad 
         Caption         =   "&Load Map"
      End
      Begin VB.Menu mnuSave 
         Caption         =   "&Save Map"
      End
      Begin VB.Menu mnuExit 
         Caption         =   "E&xit"
      End
   End
End
Attribute VB_Name = "frmMain"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Public tileSelected As Integer

Public MapWidth As Integer
Public MapHeight As Integer
Dim MapTiles() As Integer
Dim Tiles As tileOBJ

Sub loadMap(filepath As String)
    Dim x As Integer, y As Integer
    Dim FileNum As Integer
    
    FileNum = FreeFile
    
    Open filepath For Input As FileNum
        Input #FileNum, MapWidth
        Input #FileNum, MapHeight
        
        ReDim MapTiles(0 To MapWidth - 1, 0 To MapHeight - 1)
        
        For y = 0 To MapHeight - 1
            For x = 0 To MapWidth - 1
                If EOF(FileNum) = False Then
                    Input #FileNum, MapTiles(x, y)
                Else
                    'MapTiles(X, Y).TileID = Rnd() * 4
                    MapTiles(x, y) = TILE_GRASS
                End If
            Next
        Next
    Close

End Sub

Sub SaveMap(filepath As String)
    Dim x As Integer, y As Integer
    Dim FileNum As Integer
    
    FileNum = FreeFile
    
    Open filepath For Output As FileNum
        Write #FileNum, MapWidth
        Write #FileNum, MapHeight
        
        For y = 0 To MapHeight - 1
            For x = 0 To MapWidth - 1
                Write #FileNum, MapTiles(x, y)
            Next
        Next
    Close
End Sub

Sub LoadTiles()
    Dim hTempDC As Long
    Dim hOldBmp As Long
    
    hTempDC = GetDC(0)
    
    Set Tiles.Pic = New StdPicture
    Set Tiles.Pic = LoadPicture(App.Path & "\Images\tiles.bmp")
    Tiles.hdc = CreateCompatibleDC(hTempDC)
    hOldBmp = SelectObject(Tiles.hdc, Tiles.Pic.Handle)
    
    Call ReleaseDC(0, hTempDC)
End Sub

Public Sub SetTiles(tileID As Integer)
    Dim x As Integer, y As Integer
    
    If tileID > NUM_TILES - 1 Then
        Exit Sub
    End If
    
    For y = 0 To MapHeight - 1
        For x = 0 To MapWidth - 1
            MapTiles(x, y) = tileID
        Next
    Next
    
End Sub


Public Sub DrawMap()
    Dim x As Integer, y As Integer
    
    For y = 0 To MapHeight - 1
        For x = 0 To MapWidth - 1
            BitBlt Me.hdc, 100 + x * TILE_WIDTH, 100 + y * TILE_HEIGHT, TILE_WIDTH, TILE_HEIGHT, Tiles.hdc, MapTiles(x, y) * 20, 0, vbSrcCopy
        Next
    Next
End Sub

Private Sub Form_Load()
    MapWidth = 10
    MapHeight = 10
    ReDim MapTiles(0 To MapWidth - 1, 0 To MapHeight - 1)
    LoadTiles
    SetTiles TILE_GRASS
End Sub

Private Sub Form_MouseDown(Button As Integer, Shift As Integer, x As Single, y As Single)
    Dim mouseX As Integer, mouseY As Integer
    Dim X2 As Integer, Y2 As Integer
    mouseX = x / 15
    mouseY = y / 15
    
    For Y2 = 0 To MapHeight - 1
        For X2 = 0 To MapWidth - 1
            If mouseX >= 100 + X2 * 20 And mouseX <= 100 + X2 * 20 + 20 Then
                If mouseY >= 100 + Y2 * 20 And mouseY <= 100 + Y2 * 20 + 20 Then
                    MapTiles(X2, Y2) = tileSelected
                End If
            End If
        Next
    Next
End Sub

Private Sub Form_Terminate()
    DeleteDC Tiles.hdc
    DeleteObject Tiles.Pic
End Sub

Private Sub mnuExit_Click()
    End
End Sub

Private Sub mnuLoad_Click()
    theDialog.DialogTitle = "Open Map..."
    theDialog.FileName = "*.map"
    theDialog.Filter = "MAP File"
    theDialog.ShowOpen
    If theDialog.FileName <> "" Then
        loadMap theDialog.FileName
    End If
End Sub

Private Sub mnuNew_Click()
    Load frmNew
    
    frmNew.Show
End Sub

Private Sub mnuSave_Click()
    theDialog.DialogTitle = "Save Map..."
    theDialog.FileName = "*.map"
    theDialog.Filter = "MAP File"
    theDialog.DefaultExt = "map"
    theDialog.ShowSave
    If theDialog.FileName <> "" And theDialog.FileName <> "*.map" Then
        SaveMap theDialog.FileName
    End If
End Sub

Private Sub picTile_Click(Index As Integer)
    tileSelected = Index
End Sub

Private Sub Timer1_Timer()
    DrawMap
End Sub

Sub RedimMap()
    ReDim MapTiles(0 To MapWidth - 1, 0 To MapHeight - 1)
End Sub

